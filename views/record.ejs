<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>STAMP APP</title>
    <script src="/send_url.js"></script>
    <script src="./script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>

<body>

    <%- include('header') %>

    <div class="main">
        <!--現在時刻-->
        <div id="current-time-wrapper">
            <h2>現在時刻</h2>
            <p id="current-time"></p>
        </div>

        <!--勤務状況(勤務外、勤務中、休憩中のいずれか)-->
        <div id="current-state-wrapper">
            <h2>現在の状況</h2>
            <p id="current-state"><%= locals.currentState %></p>
        </div>

        <!--勤務開始時刻-->
        <div id="start-time-wrapper">
            <h2>勤務開始時刻</h2>
            <p id="start-time"><%= locals.startWorkTime %></p>
        </div>

        <!--勤務終了時刻-->
        <div id="finish-time-wrapper">
            <h2>勤務終了時刻</h2>
            <p id="finish-time"><%= locals.finishWorkTime %></p>
        </div>

        <!--本日の勤務時間
        <div id="working-hours-wrapper">
            <h2>本日の勤務時間</h2>
            <p id="working-hours">00:00:00</p>
        </div>
        -->

        <!--打刻-->
        <div class="btn-wrapper"> 
            <h2>打刻</h2>

            <!--出勤-->
            <form action="/start_work" method="post" style="display: inline">
                <input type="submit" value="出勤">
            </form>

            <!--退勤-->
            <form action="/finish_work" method="post" style="display: inline">
                <input type="submit" value="退勤">
            </form>
        </div>

        <!--過去の勤務状況-->
        <div class="table-wrapper">
            <h2 class="table-label">過去の勤務状況</h2>

            <% if (locals.isLoggedIn) { %>
                
                <div class="table-head">
                    <span class="day-column">
                        日付
                    </span>
                    <span class="working-hours-column">
                        勤務時間
                    </span>
                </div>
                <ul class="table-body">
                    <% work_data.forEach((datum) => { 
                        function twoDigit(num) {
                            let ret;
                            if( num < 10 ) 
                                ret = "0" + num; 
                            else 
                                ret = num; 
                            return ret;
                        }
                        let date = datum.date;
                        let year  =          date.getFullYear();
                        let month = twoDigit(date.getMonth() + 1);
                        let day   = twoDigit(date.getDate());
                        let date_string = year + "/" + month + "/" + day;
                        if (datum.username === locals.username) { %>
                            <li>
                                <span class="day-column">
                                    <%= date_string %>
                                </span>
                                <span class="working-hours-column">
                                    <%= datum.working_hours %>
                                </span>
                                <form action="/delete/<%= datum.id %>" method="post" style="display: inline">
                                    <input type="submit" value="削除">
                                </form>
                            </li>
                        <% }
                    }); %>
                </ul>

                <canvas id="sample1"></canvas>
                <script>
                    (function(){
                        var ctx = document.getElementById("sample1");
                        
                        var data = {
                            labels: ["4月", "5月", "6月", "7月", "8月"],
                            datasets: [{
                                label: '任天堂',
                                data: [11433, 23510, 15943, 34212, 19841], //配列でデータをセット
                                borderColor: 'rgba(255, 0, 0, 1)', //ボーダーの色
                            }]
                        };
                        
                        var options = {};
                        var ex_chart = new Chart(ctx, {
                            type: 'line', //折れ線グラフ
                            data: data, //上記設定のデータ
                            options: options
                        });
                    }());
                </script>

            <% } else { %>
                <p>ログインしてください</p>
            <% } %>
            
        </div>
    </div>

</body>

</html>